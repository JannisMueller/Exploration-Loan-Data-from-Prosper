---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.0'
      jupytext_version: 0.8.6
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

# Exploration Loan Data from Prosper
## by Jannis

## Preliminary Wrangling

This data set contains 113,937 loans with 81 variables on each loan, including loan amount, borrower rate (or interest rate), current loan status, borrower income, and many others

```{python}
# import all packages and set plots to be embedded inline
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sb
import requests
import io

# %matplotlib inline
```

```{python}
# Loading the dataset
url = 'https://s3.amazonaws.com/udacity-hosted-downloads/ud651/prosperLoanData.csv'
response = requests.get(url).content
loan_data = pd.read_csv(io.StringIO(response.decode('utf-8')))
loan_data.head()
```

```{python}
# high-level overview of data shape and composition
print(loan_data.shape)
print(loan_data.dtypes)
```

### The structure of the dataset

The Data set contains 113,937 loans (rows) with 81 variables (columns) on each loan. Most variables are integers (numeric) or strings (objects). But the dataset also has some categorical variables: for example CreditGrade, ProsperRating, EmploymentStatus, LoanStatus, ProsperScore

(worst) ——> (best)

### Main features of interest in the dataset

The huge dataset with a lot of informaton (81 variables) allows me to have deeper look at the question what factors affect a loan’s outcome status (Cancelled, Chargedoff, Completed, Current, Defaulted, FinalPaymentInProgress, PastDue)?

This is a very critical question for banks and loan companies in order to minimize the default risk and and to set the right interest rate (including setting a proper risk premium).

This investigation might help to find out what factors predict the outcome of a loan best. 
  



### Features in the dataset that will help support the investigation

I think the factors that have the most influence on predicting the outcome of a loan are:

 - Term (The length of the loan expressed in months)
 - ProsperScore (custom risk score)
 - EmploymentStatus (The employment status of the borrower)
 - StatedMonthlyIncome & MonthlyLoanPayment
 - IncomeRange
 - BorrowerAPR
 - BorrowerRate
 - LoanOriginalAmount
 - OpenCreditLines (Number of open credit line)
 - TotalProsperPaymentsBilled (number of on time payments the borrower made on Prosper loans at the time they created this listing)


Whereby I expect  to have  `ProsperScore`, `TotalProsperPaymentsBilled`, `LoanOriginalAmount`, `BorrowerRate`,  (high interest rate are associated with higher default risk) and `monthly income` and `monthly loan payment`  have  the strongest effect on the loan's outcome status.
 


In the first step I will create a copy of the dataset with the variables of interest

```{python}
# create a copy of the dataset
loan_data_clean = loan_data.copy()
# include all variables that are needed in the investigation in the clean copy
loan_data_clean = loan_data_clean[['Term','ProsperScore','EmploymentStatus','StatedMonthlyIncome', 'MonthlyLoanPayment', 'IncomeRange','BorrowerAPR','BorrowerRate','LoanOriginalAmount', 'OpenCreditLines','TotalProsperPaymentsBilled']]
#getting a overview over the new dataset
print(loan_data_clean.head())
print(loan_data_clean.info())
```

## Univariate Exploration

I'll start by looking at the distribution of the main variable of interest ProsperScore, TotalProsperPaymentsBilled, BorrowerRate and ratio_income_loanPayment



> In this section, investigate distributions of individual variables. If
you see unusual points or outliers, take a deeper look to clean things up
and prepare yourself to look at relationships between variables.





> Make sure that, after every plot or related series of plots, that you
include a Markdown cell with comments about what you observed, and what
you plan on investigating next.

```{python}
# Histogramm Prosper Score
binsize = 0.5
bins = np.arange(1, loan_data_clean.ProsperScore.max()+binsize, binsize)

plt.figure(figsize=[8, 5])
plt.hist(data = loan_data_clean, x = 'ProsperScore', bins = bins)
plt.xlabel('Prosper Score')
plt.ylabel('Count')
plt.show()
```

```{python}
# Histogramm TotalProsperPaymentsBilled (Number of on time payments)
binsize = 1
bins = np.arange(loan_data_clean.TotalProsperPaymentsBilled.min(), loan_data_clean.TotalProsperPaymentsBilled.max()+binsize, binsize)

plt.figure(figsize=[8, 5])
plt.hist(data = loan_data_clean, x = 'TotalProsperPaymentsBilled', bins = bins)
plt.xlabel('Number of on time payments')
plt.ylabel('Count')
plt.show()
```

```{python}
loan_data_clean.StatedMonthlyIncome.describe()
```

```{python}
# Histogramm  StatedMonthlyIncome 
binsize = 1
bins = np.arange(loan_data_clean.StatedMonthlyIncome.min(), loan_data_clean.StatedMonthlyIncome.max()+binsize, binsize)

plt.figure(figsize=[8, 5])
plt.hist(data = loan_data_clean, x = 'StatedMonthlyIncome', bins = bins)
plt.xlabel('Monthly Income')
plt.ylabel('Count')
plt.show()
```

```{python}
loan_data.BorrowerRate.describe()
```

```{python}
# Histogramm  BorrowerRate (Borrower's interest rate for this loan.)
binsize = 0.01
bins = np.arange(loan_data.BorrowerRate.min(), loan_data.BorrowerRate.max()+binsize, binsize)

plt.figure(figsize=[8, 5])
plt.hist(data = loan_data_clean, x = 'BorrowerRate', bins = bins)
plt.xlabel('Interest Rate')
plt.ylabel('Count')
plt.show()
```

### Discuss the distribution(s) of your variable(s) of interest. Were there any unusual points? Did you need to perform any transformations?

> Your answer here!

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

> Your answer here!


## Bivariate Exploration

> In this section, investigate relationships between pairs of variables in your
data. Make sure the variables that you cover here have been introduced in some
fashion in the previous section (univariate exploration).

```{python}

```

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

> Your answer here!

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

> Your answer here!


## Multivariate Exploration

> Create plots of three or more variables to investigate your data even
further. Make sure that your investigations are justified, and follow from
your work in the previous sections.

```{python}

```

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

> Your answer here!

### Were there any interesting or surprising interactions between features?

> Your answer here!


> At the end of your report, make sure that you export the notebook as an
html file from the `File > Download as... > HTML` menu. Make sure you keep
track of where the exported file goes, so you can put it in the same folder
as this notebook for project submission. Also, make sure you remove all of
the quote-formatted guide notes like this one before you finish your report!


### Engineering a new variable

```{python}
print(loan_data_clean.StatedMonthlyIncome.head())
print(loan_data_clean.MonthlyLoanPayment.head())
```

```{python}
# in the first step I create a new variable ratio_income_loanPayment
loan_data_clean['ratio_income_loanPayment'] = (loan_data_clean.MonthlyLoanPayment / loan_data_clean.StatedMonthlyIncome)*100
# round the ratio to 2 decimals
loan_data_clean['ratio_income_loanPayment'] = loan_data_clean['ratio_income_loanPayment'].round(2)
print(loan_data_clean['ratio_income_loanPayment'].sample(3))
print(loan_data_clean['ratio_income_loanPayment'].describe())
```

One can see from the statisitcs that there are null values and values generate by dividing by zero

```{python}
loan_data_clean.StatedMonthlyIncome.value_counts().head(20)
```

```{python}
loan_data_clean.MonthlyLoanPayment.value_counts().head(20)
```
